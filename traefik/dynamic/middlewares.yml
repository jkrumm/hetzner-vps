## Traefik dynamic configuration — middlewares
## Applied via labels: traefik.http.routers.<name>.middlewares=rate-limit@file,security-headers@file

http:
  middlewares:

    # Rate limiting — per source IP.
    # Built-in Traefik middleware, no external dependency.
    rate-limit:
      rateLimit:
        average: 100
        burst: 200
        period: 1s

    # Security headers — HSTS + browser security hardening.
    security-headers:
      headers:
        frameDeny: true
        contentTypeNosniff: true
        browserXssFilter: true
        referrerPolicy: "strict-origin-when-cross-origin"
        permissionsPolicy: "camera=(), microphone=(), geolocation=(), payment=()"
        stsSeconds: 31536000
        stsIncludeSubdomains: true
        stsPreload: true
        forceSTSHeader: true
        customFrameOptionsValue: "SAMEORIGIN"

    # Tailscale-only — restrict access to Tailscale CGNAT range (100.64.0.0/10).
    # Applied to internal dashboards (Traefik). Tailscale membership IS the auth.
    # Basic auth intentionally omitted: redundant for a personal tailnet and
    # dynamic config files don't support ${ENV_VAR} substitution anyway.
    tailscale-only:
      ipAllowList:
        sourceRange:
          - "100.64.0.0/10"
